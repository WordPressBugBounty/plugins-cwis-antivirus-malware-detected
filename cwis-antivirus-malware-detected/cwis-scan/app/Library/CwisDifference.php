<?php

namespace App\Library;

class CwisDifference
{

    /**
     * Converts string into the array suitable for comparison using array_diff.
     * @param string $string
     * @return array
     */
    function convert($string = '')
    {
        $string_wrapped = wordwrap((string) $string, 300);
        return preg_split('#>\s*<|\s*[\n\r{}]+\s*#sm', $string_wrapped, null, PREG_SPLIT_NO_EMPTY);
    }

    /**
     * Calculates the difference between two or more strings.
     * @param string $string
     * @return null|float
     */
    function compare()
    {
        $difference = 0;

        // Minimum arguments count check
        $num_args = func_num_args();
        $arg_list = func_get_args();
        if ($num_args <= 1) {
            return null;
        }

        // Prepare the first argument
        $primary_arg_converted = $this->convert($arg_list[0]);
        $primary_arg_sizeof = count($primary_arg_converted);

        // Process function arguments
        for ($i = 1; $i < $num_args; $i++) {
            $current_arg_converted = $this->convert($arg_list[$i]);
            $current_arg_sizeof = count($current_arg_converted);

            // Calculate difference of the first array from an another (faster the intersect)
            $current_arg_difference_sizeof = count(array_diff($primary_arg_converted, $current_arg_converted));
            if ($current_arg_sizeof > 0) {
                $difference += $current_arg_difference_sizeof * 2 / ($primary_arg_sizeof + $current_arg_sizeof);
            }
        }

        // Return the average difference value
        return $difference / ($num_args - 1);
    }

}
