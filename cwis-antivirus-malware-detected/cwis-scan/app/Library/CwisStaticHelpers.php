<?php

namespace App\Library;

use App\State;

class CwisStaticHelpers
{
    public static function get_server_host()
    {
        if (!State::isCli()) {
            $http_host = htmlentities(get_server_env('HTTP_HOST'));
            $host = $http_host ? $http_host : get_server_env('SERVER_NAME');
        } elseif (functions_exists('gethostname')) {
            $host = gethostname();
        } else {
            $host = php_uname('n');
        }

        // Remove port number from host
        return trim(preg_replace('/:\d+$/', '', $host));
    }

    /**
     * Prints message to the console.
     * @param mixed $text
     * @param bool $line_break Add line break
     * @return void
     */
    public static function cwis_stdout_message($text = '', $line_break = true)
    {
        if (!(State::isCli() && !CWIS_IS_CGI)) {
            return null;
        }

        // Convert to printable
        if (is_bool($text)) {
            $text = $text ? 'true' : 'false';
        } elseif (is_null($text)) {
            $text = 'null';
        } else // non-scalar to string
            if (!is_scalar($text)) {
                $text = print_r($text, true);
            }

        @fwrite(STDOUT, $text . ($line_break ? "\n" : ''));
    }
}
