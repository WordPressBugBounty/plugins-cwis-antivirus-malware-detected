<?php

namespace App\Actions;

use App\State;
use App\Library\CwisApi;

class Sync extends BaseAction
{
    public function __invoke($step): array
    {
        $result   = [ 'success' => true, 'time' => time() ];

        if($step == 4) {
          $hashes = CwisApi::fetch_hashes(true); // Skip Cached
          $result['data'] = count($hashes);
        } else {
          $result['data'] = json_decode(CwisApi::sync_step($step));
        }

        $result['elapsed'] = time() - $result['time'];

        return $result;
    }
}
