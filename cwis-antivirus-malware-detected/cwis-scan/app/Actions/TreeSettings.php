<?php

namespace App\Actions;

use App\State;
use Exception;

class TreeSettings extends BaseAction
{
    public function __invoke($params): ?array
    {
        $op = isset($params['cwis_task']) ? $params['cwis_task'] : '-';
        $res = ['success' => false];

        switch ($op) {
            case 'set':
                if (isset($params['filters'])) {
                    $this->set($params['filters']);
                    $res['success'] = true;
                }

                break;
            default:
                $res = $this->get();
                break;
        }

        return $res;
    }

    private function set($filters)
    {
        State::setcnf('CWIS_RESULT_FILTER', $filters);
    }

    private function get()
    {
        $settings = State::cnf('CWIS_RESULT_FILTER');

        if (null === $settings) {
            $settings = $this->default();
            State::setcnf('CWIS_RESULT_FILTER', $settings);
        }

        return $settings;
    }

    private function default()
    {
        return [
            'ext' => [ 'mp3','wav','m4a','flac','mp4','ogg','webm','mpg',
                'ogv','m4v','asf','avi','flv','swf','css','webp',
                'jpeg','svg','jpg','png','gif','raw','bmp','eot','ttf'
            ],
            'types' => [
                'BigFiles',
                'match',
                'BigFiles',
                'SkippedDirs',
                'Whitelisted',
                'quarantine'
            ],
            'query_logic' => 1,
            'show_matching' => -1,
            'show_missing' => -1,
            'show_anomalies' => -1,
            'show_quarantine' => -1,
            'show_expanded' => 0,
            'expand_matching_core' => 0,
            'expand_matching_plugins' => 0,
            'expand_matching_themes' => 0,
            'expand_missing_core' => 1,
            'expand_missing_plugins' => 0,
            'expand_missing_themes' => 0,
            'expand_quarantine_folders' => 0
        ];
    }
}
