<?php

namespace App\Actions;

use App\Library\CwisServerEnvInfo;
use App\State;

class Sysinfo extends BaseAction {
    public function __invoke($log_lines = 100): array {

      // Get server info
      $serverEnvInfo = new CwisServerEnvInfo();
      $serverEnvInfo->construct();
      $serverEnvInfo->parseResultInfo('json');

      // CMS detected
      if (isset($this->results['DetectedCMS']) && count($this->results['DetectedCMS']) > 0) {
          $serverEnvInfo->insertResult('cms', $this->results['DetectedCMS']);
      }

      // Plugins detected
      if (isset($this->results['DetectedPlugins']) && count($this->results['DetectedPlugins']) > 0) {
          $serverEnvInfo->insertResult('plugins', $this->results['DetectedPlugins']);
      }

      $result = $serverEnvInfo->printHtmlReport('json');

      //foreach ($result as $key => $item) {
      //    if (in_array($item['type'], ["info", "server"])) {
      //        unset($result[$key]);
      //    }
      //}

      return $result;

    }
}
