<?php

namespace App\Actions;

use App\State;
use App\Library\CwisSiteCheck;
use App\Library\CwisStaticHelpers;
use App\Library\CwisUtilities;
use App\Library\CwisApi;

class Scheduler extends BaseAction {

    public function __invoke($params = []): ?array {
        return self::run($params);
    }

    function run($params) {

        if(!isset($params['cwis_task'])) {
          $params['cwis_task'] = 'view';
        }

        $op = $params['cwis_task'];

        switch($op) {
            case 'change':
                $config = $params['cwis_task_config'];
                $config['extskip'] = array_values(array_unique($config['extskip']));
                State::setcnf('CWIS_SCANNER', $config);
                return json_decode(CwisApi::scheduler_set($config), true);
            break;

            case 'view':
                return State::cnf('CWIS_SCANNER');
            break;
        }

        return [];

    }

}
