<?php

namespace App\Actions;

use App\State;

class Start extends BaseAction
{
    public function __invoke(): ?array
    {
        if (!class_exists('Cwis_Scanner_Ajax')) {
            if (!require_once(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'scanner' . DIRECTORY_SEPARATOR . 'class-ajax.php')) {
                throw new \Exception('Cannot load ajax', 500);
            }
        }

        return ['success' => self::scanner_start()];
    }

    public static function scanner_start() {

        $cwis_application_rest = new \Cwis_Updater_Methods('cwis', State::pluginVersion());
        $cwis_ajax_class = $cwis_application_rest->get_class_instance('Cwis_Scanner_Ajax');
        $cwis_ajax_class->cwis_scanner_ajax_callback2();

        return true;
    }
}
